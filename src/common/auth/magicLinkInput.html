<!DOCTYPE html>
<html>
<head>
  <title>Request Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Base Styles (for Desktop) */
    html {
      font-size: 16px; /* Base font size for desktop - 1rem = 16px */
      box-sizing: border-box;
    }

    *, *::before, *::after {
      box-sizing: inherit; /* Inherit box-sizing globally */
    }

    body {
      font-family: sans-serif;
      display: flex; /* Flexbox for centering on desktop */
      justify-content: center;
      align-items: center;
      min-height: 100vh; /* This might be tricky in a fixed-size iframe. Consider adjusting if centering issues arise. */
      margin: 0;
      box-sizing: border-box; /* Ensuring body also respects box-sizing */
      background-color: #FFFFE0; /* Light Yellow for Desktop */
    }

    .container {
      width: 25rem; /* 400px / 16px = 25rem */
      padding: 1.25rem; /* 20px / 16px = 1.25rem */
      border: 0.0625rem solid #ccc; /* 1px / 16px = 0.0625rem */
      border-radius: 0.5rem; /* 8px / 16px = 0.5rem */
      box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1); /* 0 4px 8px */
    }

    h2 {
      font-size: 1.8rem; /* Desktop h2: 1.8 * 16px = 28.8px */
      text-align: center;
      margin-top: 0;
      margin-bottom: 1.25rem; /* 20px / 16px = 1.25rem */
    }

    input[type=email], button {
      width: 100%;
      padding: 0.75rem 1.25rem; /* 12px 20px */
      margin-bottom: 0.625rem; /* 10px / 16px = 0.625rem */
      display: block; /* Ensures they stack */
      border: 0.0625rem solid #ccc;
      border-radius: 0.25rem; /* 4px / 16px = 0.25rem */
      font-size: 1rem; /* Base font size for inputs/buttons (1 * 16px = 16px) */
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover:not(:disabled) {
      background-color: #45a049;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .message {
      margin-top: 0.625rem; /* 10px / 16px = 0.625rem */
      font-size: 0.9rem; /* 0.9 * 16px = 14.4px */
      text-align: center;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }

    /* --- Responsive Styles (Applied by JavaScript classes on <body>) --- */

    /* Tablet Styles */
    body.is-tablet {
      background-color: #ADD8E6; /* Light Blue for Tablet */
      /* No change to display/padding from desktop for tablet, maintain desktop flex behavior unless explicitly overridden */
    }

    body.is-tablet html {
      font-size: 17px; /* Tablet base font: 1rem = 17px */
    }

    body.is-tablet .container {
      width: 80%; /* Wider on tablet, still centered */
      max-width: 37.5rem; /* 600px / 16px = 37.5rem (This max-width will now scale based on the 17px base) */
      padding: 1.5625rem; /* 25px / 17px = ~1.47rem */
    }

    body.is-tablet h2 {
      font-size: 2.0rem; /* Tablet h2: 2.0 * 17px = 34px (Larger than Desktop h2) */
    }

    /* Mobile Portrait Styles */
    body.is-mobile-portrait {
      display: block; /* Override flex for mobile portrait layout */
      padding: 0.9375rem; /* 15px / 18px = ~0.83rem (relative to new 18px base) */
      background-color: #FFB6C1; /* Light Magenta for Mobile Portrait */
    }

    body.is-mobile-portrait html {
      font-size: 18px; /* Mobile Portrait base font: 1rem = 18px */
    }

    body.is-mobile-portrait .container {
      width: 95%;
      margin: 0 auto; /* Center container on mobile block layout */
      padding: 0.9375rem; /* 15px / 18px = ~0.83rem */
    }

    body.is-mobile-portrait h2 {
      font-size: 2.2rem; /* Mobile Portrait h2: 2.2 * 18px = 39.6px (Largest h2) */
      text-align: left;
      margin-bottom: 0.9375rem; /* 15px / 18px = ~0.83rem */
    }

    body.is-mobile-portrait input[type=email],
    body.is-mobile-portrait button {
      padding: 1rem; /* 18px / 18px = 1rem */
      font-size: 1.1rem; /* 1.1 * 18px = 19.8px */
    }

    body.is-mobile-portrait .message {
      font-size: 1rem; /* 1 * 18px = 18px */
      text-align: left;
    }

    /* Mobile Landscape Styles */
    body.is-mobile-landscape {
        /* Mobile landscape might share some characteristics with tablet,
           or have its own distinct styling. For now, let's make it distinct
           from portrait and different from tablet.
           You'll likely want to adjust these values based on actual testing. */
        display: block; /* Typically block layout for wider content */
        padding: 0.8rem; /* Slightly less padding than portrait */
        background-color: #E0FFFF; /* Light Cyan for Mobile Landscape */
    }

    body.is-mobile-landscape html {
        font-size: 17.5px; /* A distinct base size for mobile landscape */
    }

    body.is-mobile-landscape .container {
        width: 90%; /* Wider than portrait, narrower than tablet */
        max-width: 30rem; /* Custom max-width for mobile landscape */
        margin: 0 auto;
        padding: 1rem;
    }

    body.is-mobile-landscape h2 {
        font-size: 2.1rem; /* 2.1 * 17.5px = 36.75px */
        text-align: center;
        margin-bottom: 1rem;
    }
    /* Input, button, message styles can inherit or be overridden here */
  </style>
</head>
<body>
  <div class="container">
    <h2>Request SCCCC <?= serviceName ?> Access Link</h2>
    <input type="email" id="email" placeholder="Enter your email address" required autocomplete="email" oninput="validateEmail()">
    <button id="sendButton" onclick="requestLink()" disabled>Send Access Link</button>
    <div id="message" class="message"></div>
  </div>

  <script>
    console.log('Service value from template:', '<?= service ?>');

    function validateEmail() {
      var emailInput = document.getElementById('email');
      var sendButton = document.getElementById('sendButton');
      sendButton.disabled = !emailInput.checkValidity();
    }

    function requestLink() {
      var email = document.getElementById('email').value;
      var messageDiv = document.getElementById('message');
      messageDiv.className = 'message'; // Reset classes
      messageDiv.textContent = 'Processing...';

      // Assuming google.script.run is defined elsewhere (e.g., Google Apps Script)
      if (typeof google !== 'undefined' && google.script && google.script.run) {
          google.script.run
              .withSuccessHandler(function(response) {
                messageDiv.className = 'message success'; // Add success class
                messageDiv.textContent = 'Processed - if the email you entered is that of an active member then we have sent an access link to that address. Go check and follow the link.';
                document.getElementById('email').value = ''; // Clear the input
              })
              .withFailureHandler(function(error) {
                  messageDiv.className = 'message error'; // Add error class
                  messageDiv.textContent = 'Error: ' + error.message; // Display error message
              })
              .sendMagicLink(email, '<?= service ?>');
      } else {
          messageDiv.className = 'message error';
          messageDiv.textContent = 'Error: google.script.run is not defined. (Are you running this in a Google Apps Script context?)';
          console.error("google.script.run is not defined. This script expects to be run in a Google Apps Script environment.");
      }
    }

    // --- Responsive JavaScript (REVISED) ---
    function checkViewportAndApplyClasses() {
      const bodyElement = document.body;
      const screenWidth = window.screen.width;
      const screenHeight = window.screen.height;
      const isPortrait = window.matchMedia('(orientation: portrait)').matches; // Robust orientation check
      // Your established breakpoints
      const mobileBreakpoint = 767;
      const tabletMinBreakpoint = 768;
      const tabletMaxBreakpoint = 1032;

      console.log('Device Screen Width (window.screen.width):', screenWidth);
      console.log('Device Screen Height (window.screen.height):', screenHeight);
      console.log('Is Portrait:', isPortrait);

      // Remove all previous responsive classes
      bodyElement.classList.remove('is-mobile-portrait', 'is-mobile-landscape', 'is-tablet');

      if (screenWidth <= mobileBreakpoint) {
        // This is a "mobile-sized" device based on its screen width
        if (isPortrait) {
          bodyElement.classList.add('is-mobile-portrait');
          console.log('- Mobile Portrait');
        } else {
          bodyElement.classList.add('is-mobile-landscape');
          console.log('- Mobile Landscape');
        }
      } else if (screenWidth >= tabletMinBreakpoint && screenWidth <= tabletMaxBreakpoint) {
        // This is a "tablet-sized" device based on its screen width
        bodyElement.classList.add('is-tablet');
        console.log('- Tablet');
      } else {
        // Desktop device (screenWidth > tabletMaxBreakpoint) - relies on base styles
        console.log('- Desktop');
      }
    }

    // Initial check on load
    checkViewportAndApplyClasses();
    // Re-check on window resize (for orientation changes)
    window.addEventListener('resize', checkViewportAndApplyClasses);

    // Initial validation check to set button state on page load
    validateEmail();
  </script>
</body>
</html>