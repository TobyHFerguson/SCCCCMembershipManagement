<!DOCTYPE html>
<html>
<head>
  <title>Request Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Base Styles (for Desktop) */
    html {
      font-size: 16px; /* Base font size for desktop */
    }

    body {
      font-family: sans-serif;
      display: flex; /* Flexbox for centering on desktop */
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      box-sizing: border-box;
      background-color: #FFFFE0; /* Light Yellow for Desktop */
    }

    .container {
      width: 400px; /* Default desktop width */
      padding: 20px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h2 {
      font-size: 1.5em;
      text-align: center;
      margin-top: 0;
      margin-bottom: 20px;
    }

    input[type=email], button {
      width: 100%;
      padding: 12px 20px;
      margin-bottom: 10px;
      display: block; /* Ensures they stack */
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 1em;
      border-radius: 4px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover:not(:disabled) {
      background-color: #45a049;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .message {
      margin-top: 10px;
      font-size: 0.9em;
      text-align: center;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }

    /* --- Responsive Styles (Applied by JavaScript classes) --- */

    /* Mobile Portrait Styles (iPhone 15 Max Pro in Portrait) */
    body.is-mobile-portrait {
      display: block; /* Override flex for mobile layout */
      padding: 15px;
      background-color: #FFB6C1; /* Light Magenta for Mobile Portrait */
    }

    body.is-mobile-portrait .container {
      width: 95%;
      margin: 0;
      padding: 15px;
    }

    body.is-mobile-portrait h2 {
      font-size: 1.8em;
      text-align: left;
      margin-bottom: 15px;
    }

    body.is-mobile-portrait input[type=email],
    body.is-mobile-portrait button {
      padding: 18px;
      font-size: 1.1em;
    }

    body.is-mobile-portrait .message {
      font-size: 1em;
      text-align: left;
    }

    /* Tablet/Mobile Landscape Styles (iPhone 15 Max Pro in Landscape, and actual Tablets) */
    body.is-tablet {
      background-color: #ADD8E6; /* Light Blue for Tablet/Mobile Landscape */
    }

    body.is-tablet html {
      font-size: 17px; /* Slightly larger base font for tablets */
    }

    body.is-tablet .container {
      width: 80%; /* Wider on tablet, still centered */
      max-width: 600px; /* Prevent it from getting too wide */
      padding: 25px;
    }

    body.is-tablet h2 {
      font-size: 1.6em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Request SCCCC <?= serviceName ?> Access Link</h2>
    <input type="email" id="email" placeholder="Enter your email address" required autocomplete="email" oninput="validateEmail()">
    <button id="sendButton" onclick="requestLink()" disabled>Send Access Link</button>
    <div id="message" class="message"></div>
  </div>

  <script>
    console.log('Service value from template:', '<?= service ?>');

    function validateEmail() {
      var emailInput = document.getElementById('email');
      var sendButton = document.getElementById('sendButton');
      sendButton.disabled = !emailInput.checkValidity();
    }

    function requestLink() {
      var email = document.getElementById('email').value;
      var messageDiv = document.getElementById('message');
      messageDiv.className = 'message'; // Reset classes
      messageDiv.textContent = 'Processing...';

      google.script.run
          .withSuccessHandler(function(response) {
            messageDiv.className = 'message success'; // Add success class
            messageDiv.textContent = 'Processed - if the email you entered is that of an active member then we have sent an access link to that address. Go check and follow the link.';
            document.getElementById('email').value = ''; // Clear the input
          })
          .withFailureHandler(function(error) {
              messageDiv.className = 'message error'; // Add error class
              messageDiv.textContent = 'Error: ' + error.message; // Display error message
          })
          .sendMagicLink(email, '<?= service ?>');
    }

    // --- Responsive JavaScript (REVISED) ---
    function checkViewportAndApplyClasses() {
      const bodyElement = document.body;
      const screenWidth = window.screen.width; // Use screen.width for device detection
      const screenHeight = window.screen.height; // Also get screen height for reference
      const isPortrait = window.matchMedia('(orientation: portrait)').matches; // Robust orientation check

      console.log('Viewport Width (window.innerWidth):', window.innerWidth);
      console.log('Screen Width (screen.width):', screenWidth);
      console.log('Screen Height (screen.height):', screenHeight);
      console.log('Is Portrait:', isPortrait);

      // Remove all previous responsive classes
      bodyElement.classList.remove('is-mobile-portrait', 'is-tablet');

      // Define breakpoints based on screen.width (the "native" device width)
      // Assuming 600px is your threshold for mobile screen.width
      const mobileScreenBreakpoint = 600; // This might be more like 480 or 430 for your actual device

      if (screenWidth <= mobileScreenBreakpoint) {
        // This is a "phone-sized" device based on screen.width (like your iPhone 15 Pro Max's 430px)
        if (isPortrait) {
          bodyElement.classList.add('is-mobile-portrait'); // Apply mobile portrait styles
        } else {
          // It's a mobile device in landscape, apply tablet-like styles
          bodyElement.classList.add('is-tablet');
        }
      } else if (screenWidth > mobileScreenBreakpoint && screenWidth <= 1023) {
        // This is an actual tablet or a larger phone reporting a larger screen.width
        bodyElement.classList.add('is-tablet');
      } else {
        // Desktop view - no special class needed, relies on base styles
      }
    }

    // Initial check on load
    checkViewportAndApplyClasses();
    // Re-check on window resize (for orientation changes)
    window.addEventListener('resize', checkViewportAndApplyClasses);

    // Initial validation check to set button state on page load
    validateEmail();
  </script>
</body>
</html>