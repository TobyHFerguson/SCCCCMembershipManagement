<h2>SCCCC <?= serviceName ?></h2>
<h2>Magic Link Request</h2>

<input type="email" id="email" placeholder="Enter your email address" required autocomplete="email"
  oninput="validateEmail()">
<button id="sendButton" onclick="requestLink()" disabled>Send Magic Link</button>
<div id="message" class="message"></div>
</div>

<script>
  console.log('Service value from template:', '<?= service ?>');

  function validateEmail() {
    var emailInput = document.getElementById('email');
    var sendButton = document.getElementById('sendButton');
    sendButton.disabled = !emailInput.checkValidity();
  }

  function requestLink() {
    var email = document.getElementById('email').value;
    var messageDiv = document.getElementById('message');
    messageDiv.className = 'message'; // Reset classes
    messageDiv.textContent = 'Processing...';

    // Assuming google.script.run is defined elsewhere (e.g., Google Apps Script)
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run
        .withSuccessHandler(function (response) {
          messageDiv.className = 'message success'; // Add success class
          messageDiv.textContent = 'Processed - if the email you entered is that of an active member then we have sent an access link to that address. Go check and follow the link.';
          document.getElementById('email').value = ''; // Clear the input
        })
        .withFailureHandler(function (error) {
          messageDiv.className = 'message error'; // Add error message
          messageDiv.textContent = 'Error: ' + error.message; // Display error message
        })
        .sendMagicLink(email, '<?= service ?>');
    } else {
      messageDiv.className = 'message error';
      messageDiv.textContent = 'Error: google.script.run is not defined. (Are you running this in a Google Apps Script context?)';
      console.error("google.script.run is not defined. This script expects to be run in a Google Apps Script environment.");
    }
  }

  // --- Responsive JavaScript (REVISED TO APPLY CLASSES TO HTML ELEMENT) ---


  // Initial validation check to set button state on page load
  validateEmail();
</script>